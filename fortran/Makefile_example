#
# Makefile for Fortran Pade_approximants program. 
#
# -------------------------------------------------------------------------------------------------------------------
# Modules

# On India:
# module load gcc/default  atlas/3.9.33/gcc openmpi/default

# On Matter:
# module load intel/12.1.4  mkl/10.3.10.319

# On Milou:
# module load intel/13.1  intelmpi/4.1

# -------------------------------------------------------------------------------------------------------------------

# Object files
OBJS = matlab.o savem.o openm.o leastsquare.o tikhonovm.o padem.o config.o input.o lapack_wrapper.o poles.o padesetup.o average.o gitversion.o rw.o meshes.o asym.o main.o

# -------------------------------------------------------------------------------------------------------------------

# Binary
PROG =  Pade_approximants

# -------------------------------------------------------------------------------------------------------------------

# Libraries

# On local machine:
LIBS = -L"${LAPACKPATH}" -llapack -lrefblas -ltmglib  -L"${ZGELSQUAD}" -lzgelsquad -L"${DGELSDQUAD}" -ldgelsdquad 

# On India:
#LIBS = -L${LIBRARY_PATH}  -llapack -lf77blas -lcblas -latlas -L${ZGELSQUAD} -lzgelsquad -L${DGELSDQUAD} -ldgelsdquad  -L/usr/local/lib -lgmp -lmblas_gmp -lmlapack_gmp

# On Matter:
#LIBS = -L$(ZGELSQUAD)  -lzgelsquad  -Nmkl -mkl=sequential

# On Milou:
#LIBS = -L${LIBRARY_PATH}  -L${ZGELSQUAD} -lzgelsquad -L${DGELSDQUAD} -ldgelsdquad # -L/usr/local/lib -lgmp -lmblas_gmp -lmlapack_gmp

# -------------------------------------------------------------------------------------------------------------------

# Compilers

# On local machine:
F90 = gfortran 
F90FLAGS =  -O2 # -fopenmp -g -Wall -fbounds-check -Waliasing -fdump-core  -Wreturn-type 

# On India:
#INCLUDE = -I/usr/local/include -I/usr/local/include/mpack
#CC = c++ -O2 # -g -fopenmp -fbounds-check  #  -Wall  # -Waddress   
#F90 = gfortran -fopenmp  
#F90FLAGS =  -O2 # -g #-Wall -fbounds-check -Waliasing -fdump-core  -Wreturn-type 

# On matter:
#F90 = ifort 
#F90FLAGS =  -O2

# On Milou:
#F90= mpiifort -lmkl_intel_lp64 -lmkl_sequential -lmkl_core

LDFLAGS = $(LIBS)

# -------------------------------------------------------------------------------------------------------------------

all: gitR $(PROG)

gitR: gitversion_template.f90
	./setgitversion.sh 

$(PROG): $(OBJS)
	$(F90) $(LIBS) -o $@ $(OBJS)

#$(F90) $(LDFLAGS) -o $@ $(OBJS) $(LIBS)

clean:
	rm -f $(PROG) $(OBJS) *.mod


.SUFFIXES: $(SUFFIXES) .f90 .F90 .f .cpp

.f.o:
	$(F77) $(F77FLAGS) -c $<
.f90.o:
	$(F90) $(F90FLAGS) -c $<
.F90.o:
	$(F90) $(F90FLAGS) -c $<
.f90.mod:
	$(F90) $(F90FLAGS) -c $<
.F90.mod:
	$(F90) $(F90FLAGS) -c $<

.mod.o:
	$(F90) $(F90FLAGS) -c $<

.cpp.o:
	$(CC) $(INCLUDE) $(LIBS) -c $<

